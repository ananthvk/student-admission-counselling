{% extends 'counselling/base.html' %}
{% block scripts %}
  {{ block.super }}
  <script>
    function collegechanged() {
      let select_node = document.getElementById('college-selector')
      let courseSelectElement = document.getElementById('course-selector')
      let college_id = select_node.value
      fetch(`http://localhost:8000/counselling/api/college/${college_id}/programs`)
        .then((response) => {
          if (!response.ok) {
            courseSelectElement.textContent = ''
            throw new Error(`${response.status}`)
          }
          return response.json()
        })
        .then((data) => {
          courseSelectElement.textContent = ''
          for (let [course_code, course_name] of Object.entries(data)) {
            const option = document.createElement('option')
            option.value = course_code
            option.textContent = `${course_code}-${course_name}`
            courseSelectElement.appendChild(option)
          }
          console.log('Modified list')
        })
        .catch((err) => {
          alert(`Network error, try again after some time ${err}`)
          courseSelectElement.textContent = ''
        })
    }
    function addcourse(){
        let selectedCoursesElement = document.getElementById("selected-courses");
        let selectedCollege = document.getElementById("college-selector")
        let selectedCourse = document.getElementById("course-selector")
        if(selectedCollege.selectedIndex === -1 || selectedCourse.selectedIndex === -1){
            // alert('Please select a college and a course')
            return;
        }
        college = selectedCollege.options[selectedCollege.selectedIndex]
        course = selectedCourse.options[selectedCourse.selectedIndex]
        
        const liChild = document.createElement('li')
        liChild.textContent = `${college.textContent} ${course.textContent}`
        selectedCoursesElement.appendChild(liChild);
    }
  </script>
{% endblock %}
{% block content %}
<h1 class="centered">
    Please fill your choices
</h1>
  <div class="flex-container">
    <select name="choice" class="choice-entry-college choice-entry-select" size="10" onchange="collegechanged()" id="college-selector">
      {% for college in colleges %}
        <option value="{{ college.id }}">{{ college.code }} {{ college.name }}</option>
      {% endfor %}
    </select>
    <select name="choice" class="choice-entry-course choice-entry-select" size="10" id="course-selector"></select>
    <div>
        <button onclick="addcourse()">Add</button>
    </div>
  </div>
  <div>
      <ol type="1" id="selected-courses">
      </ol>
  </div>
{% endblock %}
